<?php/* Add this on all pages on top. */set_include_path($_SERVER['DOCUMENT_ROOT'].'/'.PATH_SEPARATOR.$_SERVER['DOCUMENT_ROOT'].'/library/classes/');/*** Standard includes */require_once 'config/database.php';require_once 'config/smarty.php';/*** Check for login */require_once 'administration/includes/auth.php';/* objects. */require_once 'class/mailinglist.php';$mailinglistObject 	= new class_mailinglist();if (isset($_GET['code']) && trim($_GET['code']) != '') {		$code = trim($_GET['code']);		$mailinglistData = $mailinglistObject->getByCode($code, 'mailinglist');		if($mailinglistData) {		$smarty->assign('mailinglistData', $mailinglistData);	} else {		header('Location: /administration/participant/subscribe/');		exit;			}}/* Check posted data. */if(count($_POST) > 0) {	$errorArray		= array();	$data 				= array();	$formValid		= true;	$success			= NULL;	$areaByName	= NULL;		if(isset($_POST['areapost_code']) && trim($_POST['areapost_code']) == '') {		$errorArray['areapost_code'] = 'required';		$formValid = false;			}		if(isset($_POST['mailinglist_name']) && trim($_POST['mailinglist_name']) == '') {		$errorArray['mailinglist_name'] = 'required';		$formValid = false;			}		if(isset($_POST['mailinglist_email']) && trim($_POST['mailinglist_email']) != '') {		if($mailinglistObject->validateEmail(trim($_POST['mailinglist_email'])) == '') {			$errorArray['mailinglist_email'] = 'Needs to be a valid email address';			$formValid = false;			} else {						$mailinglistcode = isset($mailinglistData) ? $mailinglistData['mailinglist_code'] : null;						$emailData = $mailinglistObject->getByEmail(trim($_POST['mailinglist_email']), 'mailinglist', $mailinglistcode);						if($emailData) {				$errorArray['mailinglist_email'] = 'Email already exists';				$formValid = false;							}		}	} else {		$errorArray['mailinglist_email'] = 'required';		$formValid = false;			}	if(isset($_POST['mailinglist_cellphone']) && trim($_POST['mailinglist_cellphone']) != '') {		if($mailinglistObject->validateCell(trim($_POST['mailinglist_cellphone'])) == '') {			$errorArray['mailinglist_cellphone'] = 'Needs to be a valid cellphone';			$formValid = false;			} else {						$mailinglistcode = isset($mailinglistData) ? $mailinglistData['mailinglist_code'] : null;						$cellData = $mailinglistObject->getByCell(trim($_POST['mailinglist_cellphone']), 'mailinglist', $mailinglistcode);						if($cellData) {				$errorArray['mailinglist_cellphone'] = 'Cell phone number already exists';				$formValid = false;							}		}	}		if(count($errorArray) == 0 && $formValid == true) {		$data 	= array();						$data['areapost_code']			= trim($_POST['areapost_code']);				$data['mailinglist_category']	= 'mailinglist';				$data['mailinglist_name']		= trim($_POST['mailinglist_name']);				$data['mailinglist_email']		= trim($_POST['mailinglist_email']);				$data['mailinglist_cellphone']	= trim($_POST['mailinglist_cellphone']);							if(isset($mailinglistData)) {			$where		= $mailinglistObject->getAdapter()->quoteInto('mailinglist_code = ?', $mailinglistData['mailinglist_code']);			$success	= $mailinglistObject->update($data, $where);		} else {			$data['mailinglist_active']	= 1;			$success = $mailinglistObject->insert($data);			}				if(count($errorArray) == 0) {			header('Location: /administration/participant/subscribe/');				exit;				}	}	/* if we are here there are errors. */	$smarty->assign('errorArray', $errorArray);	}$smarty->display('administration/participant/subscribe/details.tpl');?>